# Project Structure

## ğŸ“ Essential Files

```
aws_s3_parquet_glue_athena/
â”‚
â”œâ”€â”€ ğŸ Core Lambda Code
â”‚   â”œâ”€â”€ lambda_function.py          # Main Lambda handler
â”‚   â”œâ”€â”€ requirements.txt            # Production dependencies
â”‚   â””â”€â”€ requirements-dev.txt        # Development dependencies
â”‚
â”œâ”€â”€ ğŸ”¨ Build & Deployment
â”‚   â”œâ”€â”€ build.sh                    # Build Lambda ZIP files
â”‚   â”œâ”€â”€ test.sh                     # Run tests locally
â”‚   â””â”€â”€ .gitignore                  # Git ignore patterns
â”‚
â”œâ”€â”€ ğŸ—ï¸ Terraform Infrastructure
â”‚   â””â”€â”€ terraform/
â”‚       â”œâ”€â”€ main.tf                 # Main infrastructure
â”‚       â”œâ”€â”€ variables.tf            # Variable definitions
â”‚       â”œâ”€â”€ outputs.tf              # Output definitions
â”‚       â”œâ”€â”€ glue.tf                 # Alternative Glue config (commented)
â”‚       â”œâ”€â”€ terraform.tfvars.example # Configuration template
â”‚       â””â”€â”€ README.md               # Terraform guide
â”‚
â”œâ”€â”€ ğŸ§ª Testing
â”‚   â”œâ”€â”€ test_local.py               # Local Lambda testing
â”‚   â”œâ”€â”€ test_local_with_output.py   # Test with Parquet output
â”‚   â”œâ”€â”€ test_unit.py                # Unit tests (pytest)
â”‚   â”œâ”€â”€ test_event.json             # Sample S3 event
â”‚   â””â”€â”€ test_data/                  # Test JSON files
â”‚       â”œâ”€â”€ example_payload.json
â”‚       â”œâ”€â”€ test_single_object.json
â”‚       â”œâ”€â”€ test_jsonl.json
â”‚       â””â”€â”€ test_multiple_outcomes.json
â”‚
â”œâ”€â”€ ğŸ“š Documentation
â”‚   â”œâ”€â”€ README.md                   # Main documentation
â”‚   â”œâ”€â”€ DEPLOYMENT_GUIDE.md         # Step-by-step deployment
â”‚   â”œâ”€â”€ LOCAL_TESTING.md            # Complete testing guide
â”‚   â”œâ”€â”€ TESTING_QUICKSTART.md       # 30-second test guide
â”‚   â”œâ”€â”€ ARCHITECTURE.md             # System architecture
â”‚   â”œâ”€â”€ DIAGRAMS.md                 # Mermaid diagrams
â”‚   â”œâ”€â”€ GLUE_SETUP.md              # Glue configuration
â”‚   â”œâ”€â”€ TERRAFORM_DESTROY.md        # Destroy procedures
â”‚   â”œâ”€â”€ TERRAFORM_UPDATES.md        # What changed
â”‚   â””â”€â”€ OPERATION_OUTCOME_EXPLOSION.md # Array explosion guide
â”‚
â”œâ”€â”€ ğŸ“‹ Reference Files
â”‚   â”œâ”€â”€ athena_ddl.sql              # Manual DDL reference
â”‚   â”œâ”€â”€ iam_policy.json             # IAM permissions
â”‚   â””â”€â”€ example_payload.json        # Example input data
â”‚
â””â”€â”€ ğŸ—‘ï¸ Auto-Generated (gitignored)
    â”œâ”€â”€ lambda_function.zip         # Built by build.sh
    â”œâ”€â”€ lambda_layer.zip            # Built by build.sh (optional)
    â”œâ”€â”€ output/                     # Test output files
    â”œâ”€â”€ __pycache__/                # Python cache
    â””â”€â”€ layer/                      # Lambda layer files

```

## ğŸ¯ Quick Reference

### To Build and Deploy

```bash
# Build Lambda function
./build.sh

# Deploy infrastructure
cd terraform
terraform init
terraform apply
```

### To Test Locally

```bash
# Quick test
./test.sh

# Or run directly
python test_local.py
pytest test_unit.py -v
```

### Essential Files Only

**Minimum required for deployment:**
- `lambda_function.py`
- `requirements.txt`
- `terraform/` directory
- `build.sh`

**Everything else is:**
- Documentation
- Testing files
- Examples
- Auto-generated artifacts (in .gitignore)

## ğŸ“ File Descriptions

### Core Files

| File | Purpose | Required |
|------|---------|----------|
| `lambda_function.py` | Lambda handler code | âœ… Yes |
| `requirements.txt` | Python dependencies | âœ… Yes |
| `terraform/main.tf` | Infrastructure definition | âœ… Yes |
| `terraform/variables.tf` | Terraform variables | âœ… Yes |
| `build.sh` | Build script | âœ… Yes |

### Optional Files

| File | Purpose | Required |
|------|---------|----------|
| `test_*.py` | Testing scripts | âŒ Optional |
| `*.md` | Documentation | âŒ Optional |
| `athena_ddl.sql` | Manual DDL reference | âŒ Optional |
| `example_payload.json` | Sample data | âŒ Optional |

### Auto-Generated (Don't Commit)

| File/Dir | Generated By | In .gitignore |
|----------|--------------|---------------|
| `lambda_function.zip` | `build.sh` | âœ… Yes |
| `lambda_layer.zip` | `build.sh` | âœ… Yes |
| `output/` | Test scripts | âœ… Yes |
| `__pycache__/` | Python | âœ… Yes |
| `layer/` | `build.sh` | âœ… Yes |
| `*.tfstate` | Terraform | âœ… Yes |

## ğŸ§¹ Clean Build

To start fresh:

```bash
# Clean all generated files
git clean -fdx

# Or manually
rm -rf __pycache__ layer output
rm -f lambda_function.zip lambda_layer.zip
rm -f terraform/*.tfstate*
```

## ğŸ“¦ Deployment Artifacts

After running `./build.sh`:

```
Generated Files:
â”œâ”€â”€ lambda_function.zip    # Lambda function code (small, ~10KB)
â””â”€â”€ lambda_layer.zip       # Dependencies (large, ~70MB)
                          # Not needed if using AWS public layer
```

**Note:** With `use_aws_public_layer = true` in Terraform, you don't need `lambda_layer.zip`.

## ğŸ“ For New Developers

### Minimum Files to Understand

1. **`lambda_function.py`** - The core logic
2. **`terraform/main.tf`** - Infrastructure setup
3. **`README.md`** - Overall guide

### To Get Started

```bash
# 1. Review the code
cat lambda_function.py

# 2. Test locally (no AWS)
pip install -r requirements-dev.txt
python test_local.py

# 3. Deploy to AWS
./build.sh
cd terraform
terraform init
terraform apply
```

---

**Keep it simple!** The project has extensive documentation, but you only need the core files to deploy and run.

